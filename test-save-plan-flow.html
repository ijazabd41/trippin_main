<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Save Plan Flow</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        .warning { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
            max-height: 300px;
            overflow-y: auto;
        }
        .step {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin: 10px 0;
        }
        .step.completed {
            border-left-color: #28a745;
        }
        .step.error {
            border-left-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Save Plan Flow</h1>
        <p>This test verifies that plans are properly saved and appear in the dashboard.</p>
        
        <div class="step" id="step1">
            <h3>Step 1: Create Test Plan Data</h3>
            <button onclick="createTestPlan()">üìù Create Test Plan</button>
            <div id="step1-result"></div>
        </div>
        
        <div class="step" id="step2">
            <h3>Step 2: Simulate Plan Generation</h3>
            <button onclick="simulatePlanGeneration()">üöÄ Generate Plan</button>
            <div id="step2-result"></div>
        </div>
        
        <div class="step" id="step3">
            <h3>Step 3: Test Save Functionality</h3>
            <button onclick="testSavePlan()">üíæ Test Save Plan</button>
            <div id="step3-result"></div>
        </div>
        
        <div class="step" id="step4">
            <h3>Step 4: Verify Dashboard Data</h3>
            <button onclick="verifyDashboardData()">üìä Check Dashboard</button>
            <div id="step4-result"></div>
        </div>
        
        <div class="step" id="step5">
            <h3>Step 5: Test Favorites</h3>
            <button onclick="testFavorites()">‚≠ê Test Favorites</button>
            <div id="step5-result"></div>
        </div>
        
        <div>
            <button onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            <button onclick="runAllTests()">üîÑ Run All Tests</button>
        </div>
        
        <h3>Current Data:</h3>
        <pre id="current-data"></pre>
    </div>

    <script>
        let testPlan = null;
        let savedTripId = null;
        
        function createTestPlan() {
            testPlan = {
                id: `test-plan-${Date.now()}`,
                title: 'Tokyo Adventure Test',
                destination: 'Tokyo, Japan',
                duration: 3,
                budget: {
                    total: 150000,
                    currency: 'JPY',
                    breakdown: {
                        accommodation: 60000,
                        transportation: 30000,
                        food: 37500,
                        activities: 15000,
                        miscellaneous: 7500
                    }
                },
                itinerary: [
                    {
                        day: 1,
                        date: '2024-01-15',
                        theme: 'Arrival & Exploration',
                        activities: [
                            {
                                time: '09:00',
                                title: 'Arrival at Tokyo',
                                description: 'Arrive and check into accommodation',
                                location: 'Tokyo',
                                type: 'transport',
                                duration: 120,
                                cost: 3000
                            },
                            {
                                time: '12:00',
                                title: 'Local Lunch',
                                description: 'Try local cuisine',
                                location: 'Tokyo',
                                type: 'dining',
                                duration: 90,
                                cost: 1500
                            }
                        ]
                    },
                    {
                        day: 2,
                        date: '2024-01-16',
                        theme: 'Cultural Exploration',
                        activities: [
                            {
                                time: '09:00',
                                title: 'Visit Senso-ji Temple',
                                description: 'Explore the historic temple',
                                location: 'Asakusa',
                                type: 'sightseeing',
                                duration: 120,
                                cost: 0
                            }
                        ]
                    }
                ],
                recommendations: [
                    {
                        type: 'Restaurant',
                        name: 'Sushi Dai',
                        description: 'Fresh sushi experience',
                        location: 'Tsukiji',
                        cost: 5000,
                        rating: 4.8
                    }
                ],
                practicalInfo: {
                    weather: 'Check local weather forecast',
                    packingList: ['Clothes', 'Passport', 'Camera'],
                    localCustoms: ['Respect local traditions'],
                    emergencyContacts: ['Police: 110', 'Ambulance: 119']
                },
                createdAt: new Date().toISOString()
            };
            
            document.getElementById('step1-result').innerHTML = 
                '<div class="success">‚úÖ Test plan created successfully!</div>';
            document.getElementById('step1').classList.add('completed');
            updateCurrentData();
        }
        
        function simulatePlanGeneration() {
            if (!testPlan) {
                document.getElementById('step2-result').innerHTML = 
                    '<div class="error">‚ùå Please create test plan first</div>';
                return;
            }
            
            // Simulate the plan generation process
            localStorage.setItem('trippin-generated-plan', JSON.stringify(testPlan));
            localStorage.setItem('trippin-complete-data', JSON.stringify({
                basicInfo: {
                    destination: 'Tokyo, Japan',
                    startDate: '2024-01-15',
                    endDate: '2024-01-18',
                    travelers: 2
                },
                travelStyle: {
                    budget: 150000,
                    interests: ['culture', 'food']
                },
                generatedPlan: testPlan
            }));
            
            document.getElementById('step2-result').innerHTML = 
                '<div class="success">‚úÖ Plan generation simulated!</div>';
            document.getElementById('step2').classList.add('completed');
            updateCurrentData();
        }
        
        function testSavePlan() {
            if (!testPlan) {
                document.getElementById('step3-result').innerHTML = 
                    '<div class="error">‚ùå Please create and generate plan first</div>';
                return;
            }
            
            // Simulate the save process
            const tripData = {
                title: testPlan.title,
                destination: testPlan.destination,
                start_date: testPlan.itinerary[0].date,
                end_date: testPlan.itinerary[testPlan.itinerary.length - 1].date,
                budget: testPlan.budget.total,
                currency: testPlan.budget.currency,
                travelers: 2,
                interests: ['culture', 'food'],
                status: 'planning',
                itinerary: testPlan.itinerary,
                recommendations: testPlan.recommendations,
                practical_info: testPlan.practicalInfo,
                is_public: false,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            
            // Generate a mock trip ID
            savedTripId = `trip_${Date.now()}`;
            tripData.id = savedTripId;
            
            // Store in localStorage as if saved to backend
            const existingTrips = JSON.parse(localStorage.getItem('trippin-trips') || '[]');
            existingTrips.unshift(tripData);
            localStorage.setItem('trippin-trips', JSON.stringify(existingTrips));
            localStorage.setItem('trippin-recent-trip', JSON.stringify(tripData));
            
            document.getElementById('step3-result').innerHTML = 
                '<div class="success">‚úÖ Plan saved successfully! Trip ID: ' + savedTripId + '</div>';
            document.getElementById('step3').classList.add('completed');
            updateCurrentData();
        }
        
        function verifyDashboardData() {
            const trips = JSON.parse(localStorage.getItem('trippin-trips') || '[]');
            const recentTrip = JSON.parse(localStorage.getItem('trippin-recent-trip') || '{}');
            
            if (trips.length === 0) {
                document.getElementById('step4-result').innerHTML = 
                    '<div class="error">‚ùå No trips found in dashboard data</div>';
                document.getElementById('step4').classList.add('error');
                return;
            }
            
            const foundTrip = trips.find(trip => trip.id === savedTripId);
            if (!foundTrip) {
                document.getElementById('step4-result').innerHTML = 
                    '<div class="error">‚ùå Saved trip not found in dashboard data</div>';
                document.getElementById('step4').classList.add('error');
                return;
            }
            
            document.getElementById('step4-result').innerHTML = 
                '<div class="success">‚úÖ Dashboard data verified! Found ' + trips.length + ' trips</div>' +
                '<div class="info">Recent trip: ' + recentTrip.title + '</div>';
            document.getElementById('step4').classList.add('completed');
            updateCurrentData();
        }
        
        function testFavorites() {
            if (!savedTripId) {
                document.getElementById('step5-result').innerHTML = 
                    '<div class="error">‚ùå No saved trip to favorite</div>';
                return;
            }
            
            // Simulate adding to favorites
            const favorites = JSON.parse(localStorage.getItem('trippin-favorites') || '[]');
            if (!favorites.includes(savedTripId)) {
                favorites.push(savedTripId);
                localStorage.setItem('trippin-favorites', JSON.stringify(favorites));
            }
            
            document.getElementById('step5-result').innerHTML = 
                '<div class="success">‚úÖ Trip added to favorites!</div>';
            document.getElementById('step5').classList.add('completed');
            updateCurrentData();
        }
        
        function clearAllData() {
            localStorage.removeItem('trippin-trips');
            localStorage.removeItem('trippin-recent-trip');
            localStorage.removeItem('trippin-favorites');
            localStorage.removeItem('trippin-generated-plan');
            localStorage.removeItem('trippin-complete-data');
            
            // Reset steps
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('completed', 'error');
            });
            
            // Clear results
            document.querySelectorAll('[id$="-result"]').forEach(result => {
                result.innerHTML = '';
            });
            
            testPlan = null;
            savedTripId = null;
            
            document.getElementById('current-data').textContent = 'All data cleared';
        }
        
        function runAllTests() {
            clearAllData();
            setTimeout(() => {
                createTestPlan();
                setTimeout(() => {
                    simulatePlanGeneration();
                    setTimeout(() => {
                        testSavePlan();
                        setTimeout(() => {
                            verifyDashboardData();
                            setTimeout(() => {
                                testFavorites();
                            }, 500);
                        }, 500);
                    }, 500);
                }, 500);
            }, 100);
        }
        
        function updateCurrentData() {
            const data = {
                testPlan: testPlan ? 'Created' : 'Not created',
                savedTripId: savedTripId || 'Not saved',
                trips: JSON.parse(localStorage.getItem('trippin-trips') || '[]'),
                recentTrip: JSON.parse(localStorage.getItem('trippin-recent-trip') || '{}'),
                favorites: JSON.parse(localStorage.getItem('trippin-favorites') || '[]')
            };
            document.getElementById('current-data').textContent = JSON.stringify(data, null, 2);
        }
        
        // Initialize
        updateCurrentData();
    </script>
</body>
</html>
